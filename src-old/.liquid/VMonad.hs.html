<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>src/VMonad.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>  1: </span><a class=annot href="#"><span class=annottext>GHC.Types.Module</span><span class='hs-keyword'>module</span></a> <span class='hs-conid'>VMonad</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>  2: </span>
<span class=hs-linenum>  3: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Equality</span>
<span class=hs-linenum>  4: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Function</span>
<span class=hs-linenum>  5: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Liquid.Equational</span>
<span class=hs-linenum>  6: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Liquid.ProofCombinators</span> <span class='hs-layout'>(</span><span class='hs-varid'>trivial</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&amp;&amp;&amp;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>==!</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>===</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>  7: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VFunctor</span>
<span class=hs-linenum>  8: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VUnit</span>
<span class=hs-linenum>  9: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 10: </span>
<span class=hs-linenum> 11: </span><span class='hs-comment'>-- Data Class.</span>
<span class=hs-linenum> 12: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum> 13: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VMonad</span>
<span class=hs-linenum> 14: </span>  <span class='hs-layout'>{</span> <span class='hs-varid'>iFunctor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VFunctor</span> <span class='hs-varid'>m</span>
<span class=hs-linenum> 15: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<span class=hs-linenum> 16: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<span class=hs-linenum> 17: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>bind_correct</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>.</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 18: </span>      <span class='hs-layout'>{</span><span class='hs-varid'>bind</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcomp</span> <span class='hs-varid'>lift</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vmapF</span> <span class='hs-varid'>iFunctor</span> <span class='hs-varid'>f</span> <span class='hs-varid'>m</span><span class='hs-layout'>}</span>
<span class=hs-linenum> 19: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>bind_identity</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 20: </span>      <span class='hs-layout'>{</span><span class='hs-varid'>bind</span> <span class='hs-varid'>m</span> <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span><span class='hs-layout'>}</span>
<span class=hs-linenum> 21: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>bind_lift</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>.</span> <span class='hs-varid'>k</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 22: </span>      <span class='hs-layout'>{</span><span class='hs-varid'>bind</span> <span class='hs-layout'>(</span><span class='hs-varid'>lift</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>k</span> <span class='hs-varid'>x</span><span class='hs-layout'>}</span>
<span class=hs-linenum> 23: </span>  <span class='hs-layout'>,</span> <span class='hs-varid'>bind_associative</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varop'>.</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k1</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>k2</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 24: </span>      <span class='hs-layout'>{</span><span class='hs-varid'>bind</span> <span class='hs-layout'>(</span><span class='hs-varid'>bind</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k1</span><span class='hs-layout'>)</span> <span class='hs-varid'>k2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bind</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>raw_kleisli</span> <span class='hs-varid'>bind</span> <span class='hs-varid'>k1</span> <span class='hs-varid'>k2</span><span class='hs-layout'>)</span><span class='hs-layout'>}</span>
<span class=hs-linenum> 25: </span>  <span class='hs-layout'>}</span>
<span class=hs-linenum> 26: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 27: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>VMonad</span>
<span class=hs-linenum> 28: </span>  <span class='hs-layout'>{</span> <span class='hs-varid'>iFunctor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>VFunctor</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 29: </span>    <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 30: </span>    <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 31: </span>    <span class='hs-varid'>bind_correct</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 32: </span>    <span class='hs-varid'>bind_identity</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 33: </span>    <span class='hs-varid'>bind_lift</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span><span class='hs-layout'>,</span>
<span class=hs-linenum> 34: </span>    <span class='hs-varid'>bind_associative</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span>
<span class=hs-linenum> 35: </span>  <span class='hs-layout'>}</span>
<span class=hs-linenum> 36: </span>
<span class=hs-linenum> 37: </span><span class='hs-comment'>-- Function.</span>
<span class=hs-linenum> 38: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>raw_kleisli</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 39: </span><span class='hs-definition'>raw_kleisli</span> <span class='hs-keyglyph'>::</span>
<span class=hs-linenum> 40: </span>  <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span>
<span class=hs-linenum> 41: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-comment'>-- bind</span>
<span class=hs-linenum> 42: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 43: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum> 44: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 45: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(a c -&gt; (c -&gt; a d) -&gt; a d) -&gt; x5:(b -&gt; a c) -&gt; x7:(c -&gt; a d) -&gt; x9:b -&gt; {VV : a d | VV == raw_kleisli x1 x5 x7 x9
                                                                                       &amp;&amp; VV == x1 (x5 x9) x7}</span><span class='hs-definition'>raw_kleisli</span></a> <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>a -&gt; b c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b c</span><span class='hs-varid'>g</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a b | v == f x}</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>a -&gt; b c</span><span class='hs-varid'>g</span></a>
<span class=hs-linenum> 46: </span>
<span class=hs-linenum> 47: </span><span class='hs-comment'>-- Function.</span>
<span class=hs-linenum> 48: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>kleisli</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum> 49: </span><span class='hs-definition'>kleisli</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 50: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; a c) -&gt; x4:(c -&gt; a d) -&gt; x6:b -&gt; {VV : a d | VV == kleisli x1 x2 x4 x6
                                                                              &amp;&amp; VV == raw_kleisli (bind x1) x2 x4 x6}</span><span class='hs-definition'>kleisli</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b c d .
      x1:(a c -&gt; (c -&gt; a d) -&gt; a d) -&gt; x5:(b -&gt; a c) -&gt; x7:(c -&gt; a d) -&gt; x9:b -&gt; {v : a d | v == raw_kleisli x1 x5 x7 x9
                                                                                            &amp;&amp; v == x1 (x5 x9) x7} | VV == raw_kleisli}</span><span class='hs-varid'>raw_kleisli</span></a> <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span>
<span class=hs-linenum> 51: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum> 52: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum> 53: </span>
<span class=hs-linenum> 54: </span><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<span class=hs-linenum> 55: </span><span class='hs-comment'>-- Equality</span>
<span class=hs-linenum> 56: </span><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<span class=hs-linenum> 57: </span>
<span class=hs-linenum> 58: </span><span class='hs-comment'>-- {-@ measure meq :: forall m a. VMonad m -&gt; m a -&gt; m a -&gt; Bool @-}</span>
<span class=hs-linenum> 59: </span>
<span class=hs-linenum> 60: </span><span class='hs-comment'>-- {-@ type EqM m a IMONAD M1 M2 = {_:EqMB m a | meq IMONAD M1 M2} @-}</span>
<span class=hs-linenum> 61: </span>
<span class=hs-linenum> 62: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum> 63: </span><span class='hs-comment'>-- data EqMB :: (* -&gt; *) -&gt; * -&gt; * where</span>
<span class=hs-linenum> 64: </span><span class='hs-comment'>--     EqMB_lift :: forall m a. iMonad:VMonad m -&gt;</span>
<span class=hs-linenum> 65: </span><span class='hs-comment'>--       x:a -&gt; y:a -&gt; PEq a {x} {y} -&gt;</span>
<span class=hs-linenum> 66: </span><span class='hs-comment'>--       EqM m a {lift iMonad x} {lift iMonad y}</span>
<span class=hs-linenum> 67: </span><span class='hs-comment'>--   | EqMB_bind :: forall m a b. iMonad:VMonad m -&gt;</span>
<span class=hs-linenum> 68: </span><span class='hs-comment'>--       m1:m a -&gt; m2:m a -&gt; EqM m a iMonad m1 m2 -&gt;</span>
<span class=hs-linenum> 69: </span><span class='hs-comment'>--       k1:(a -&gt; m _) -&gt; k2:(a -&gt; m _) -&gt; (x:a -&gt; EqM</span>
<span class=hs-linenum> 70: </span><span class='hs-comment'>--         {_:EqMB m _ | meq iMonad (k1 x) (k2 x)}) -&gt;</span>
<span class=hs-linenum> 71: </span>
<span class=hs-linenum> 72: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum> 73: </span><span class='hs-comment'>-- -- {_:EqMB m a | meq iMonad m1 m2}</span>
<span class=hs-linenum> 74: </span><span class='hs-comment'>-- -- {_:EqMB m _ | meq iMonad (bind iMonad m1 k2) (bind iMonad m2 k2)}</span>
<span class=hs-linenum> 75: </span><span class='hs-comment'>-- --</span>
<span class=hs-linenum> 76: </span><span class='hs-comment'>-- -- EqM m a iMonad (lift iMonad x) (lift iMonad y)</span>
<span class=hs-linenum> 77: </span><span class='hs-comment'>-- -- EqM m b iMonad (k1 x) (k2 x)</span>
<span class=hs-linenum> 78: </span><span class='hs-comment'>-- -- EqM m b iMonad (bind iMonad m1 k1) (bind iMonad m2 k2)</span>
<span class=hs-linenum> 79: </span><span class='hs-comment'>-- data EqMB :: (* -&gt; *) -&gt; * -&gt; * where</span>
<span class=hs-linenum> 80: </span><span class='hs-comment'>--   EqMB_lift ::</span>
<span class=hs-linenum> 81: </span><span class='hs-comment'>--     forall m a.</span>
<span class=hs-linenum> 82: </span><span class='hs-comment'>--     VMonad m -&gt;</span>
<span class=hs-linenum> 83: </span><span class='hs-comment'>--     a -&gt; -- x</span>
<span class=hs-linenum> 84: </span><span class='hs-comment'>--     a -&gt; -- y</span>
<span class=hs-linenum> 85: </span><span class='hs-comment'>--     Proof -&gt; -- x = y</span>
<span class=hs-linenum> 86: </span><span class='hs-comment'>--     -----------------------------------</span>
<span class=hs-linenum> 87: </span><span class='hs-comment'>--     EqMB m a -- lift x = lift y</span>
<span class=hs-linenum> 88: </span><span class='hs-comment'>--   EqMB_bind ::</span>
<span class=hs-linenum> 89: </span><span class='hs-comment'>--     forall m a b.</span>
<span class=hs-linenum> 90: </span><span class='hs-comment'>--     VMonad m -&gt;</span>
<span class=hs-linenum> 91: </span><span class='hs-comment'>--     m a -&gt; -- m1</span>
<span class=hs-linenum> 92: </span><span class='hs-comment'>--     m a -&gt; -- m2</span>
<span class=hs-linenum> 93: </span><span class='hs-comment'>--     EqMB m a -&gt; -- m1 = m2</span>
<span class=hs-linenum> 94: </span><span class='hs-comment'>--     (a -&gt; m b) -&gt; -- k1</span>
<span class=hs-linenum> 95: </span><span class='hs-comment'>--     (a -&gt; m b) -&gt; -- k2</span>
<span class=hs-linenum> 96: </span><span class='hs-comment'>--     (a -&gt; EqMB m b) -&gt; -- forall x, k1 x = k2 x</span>
<span class=hs-linenum> 97: </span><span class='hs-comment'>--     EqMB m b -- m1 &gt;&gt;= k1 = m2 &gt;&gt;= k2</span>
<span class=hs-linenum> 98: </span>
<span class=hs-linenum> 99: </span><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<span class=hs-linenum>100: </span><span class='hs-comment'>-- Sequencing</span>
<span class=hs-linenum>101: </span><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<span class=hs-linenum>102: </span>
<span class=hs-linenum>103: </span><span class='hs-comment'>-- Function. Monadic sequencing.</span>
<span class=hs-linenum>104: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vseq</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>105: </span><span class='hs-definition'>vseq</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>106: </span><a class=annot href="#"><span class=annottext>forall a b c .
x1:(VMonad.VMonad a) -&gt; x2:a b -&gt; x3:a c -&gt; {VV : a c | VV == vseq x1 x2 x3
                                                        &amp;&amp; VV == bind x1 x2 (vconst x3)}</span><span class='hs-definition'>vseq</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>m1</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>m2</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a b | v == m1}</span><span class='hs-varid'>m1</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; {v : b c | v == vconst m2 x1
                   &amp;&amp; v == m2}</span><span class='hs-varid'>vconst</span></a> <a class=annot href="#"><span class=annottext>{v : a b | v == m2}</span><span class='hs-varid'>m2</span></a>
<span class=hs-linenum>107: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>108: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>109: </span>
<span class=hs-linenum>110: </span><span class='hs-comment'>-- Term. The unit-monadic identity for monadic sequencing.</span>
<span class=hs-linenum>111: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vseq_epsilon</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>112: </span><span class='hs-definition'>vseq_epsilon</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span>
<span class=hs-linenum>113: </span><a class=annot href="#"><span class=annottext>forall a .
x1:(VMonad.VMonad a) -&gt; {VV : a () | VV == vseq_epsilon x1
                                     &amp;&amp; VV == lift x1 ()}</span><span class='hs-definition'>vseq_epsilon</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>{v : () | v == ()}</span><span class='hs-conid'>()</span></a>
<span class=hs-linenum>114: </span>
<span class=hs-linenum>115: </span><span class='hs-comment'>-- Lemma.</span>
<span class=hs-linenum>116: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>117: </span><span class='hs-definition'>vseq_identity_left</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varop'>.</span> <span class='hs-varid'>iMonad</span><span class='hs-conop'>:</span><span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>118: </span>  <span class='hs-keyword'>{IsIdentityLeft (vseq iMonad) (vseq_epsilon iMonad) m}</span>
<span class=hs-linenum>119: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>120: </span><span class='hs-definition'>vseq_identity_left</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span>
<span class=hs-linenum>121: </span><a class=annot href="#"><span class=annottext>forall a .
x1:(VMonad.VMonad a) -&gt; x2:a () -&gt; {VV : () | vseq x1 (vseq_epsilon x1) x2 == x2}</span><span class='hs-definition'>vseq_identity_left</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a ()</span><span class='hs-varid'>m</span></a> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>122: </span>  <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()
            &amp;&amp; v == vseq_epsilon_}</span><span class='hs-varid'>vseq_epsilon_</span></a> <span class='hs-varop'>&gt;&gt;</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a>
<span class=hs-linenum>123: </span>    <span class='hs-varop'>==.</span> <a class=annot href="#"><span class=annottext>{v : a () | v == lift_ vunit}</span><span class='hs-varid'>lift_</span></a> <a class=annot href="#"><span class=annottext>{v : () | v == ()
          &amp;&amp; v == vunit}</span><span class='hs-varid'>vunit</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:() -&gt; {v : a () | v == vconst m x1
                     &amp;&amp; v == m}</span><span class='hs-varid'>vconst</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a>
<span class=hs-linenum>124: </span>    <span class='hs-varop'>==.</span> <a class=annot href="#"><span class=annottext>{v : a ()&lt;pa&gt; | true}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{v : a () | v == vconst m vunit
            &amp;&amp; v == m}</span><span class='hs-varid'>vconst</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <a class=annot href="#"><span class=annottext>{v : () | v == ()
          &amp;&amp; v == vunit}</span><span class='hs-varid'>vunit</span></a> <span class='hs-varop'>?</span> <a class=annot href="#"><span class=annottext>()</span><span class='hs-varid'>bind_lift_</span></a> <a class=annot href="#"><span class=annottext>x1:() -&gt; {v : a () | v == vconst m x1
                     &amp;&amp; v == m}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>vconst</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{v : () | v == ()
          &amp;&amp; v == vunit}</span><span class='hs-varid'>vunit</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>125: </span>    <span class='hs-varop'>==.</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a>
<span class=hs-linenum>126: </span>    <span class='hs-varop'>***</span> <a class=annot href="#"><span class=annottext>{v : Language.Haskell.Liquid.Equational.QED | v == QED}</span><span class='hs-conid'>QED</span></a>
<span class=hs-linenum>127: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>128: </span>    <a class=annot href="#"><span class=annottext>x1:a () -&gt; x2:a () -&gt; {v : a () | v == vseq iMonad x1 x2
                                  &amp;&amp; v == bind iMonad x1 (vconst x2)}</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:a () -&gt; x2:a () -&gt; {v : a () | v == vseq iMonad x1 x2
                                  &amp;&amp; v == bind iMonad x1 (vconst x2)}</span><span class='hs-varid'>vseq</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>129: </span>    <a class=annot href="#"><span class=annottext>a () -&gt; (() -&gt; a ()) -&gt; a ()</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>130: </span>    <a class=annot href="#"><span class=annottext>() -&gt; a ()</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>131: </span>    <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()}</span><span class='hs-varid'>vseq_epsilon_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()}</span><span class='hs-varid'>vseq_epsilon</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>132: </span>    <a class=annot href="#"><span class=annottext>k:(() -&gt; a ()) -&gt; x:() -&gt; {v : () | bind iMonad (lift iMonad x) k == k x}</span><span class='hs-varid'>bind_lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b .
      k:(a -&gt; c b) -&gt; x:a -&gt; {v : () | bind iMonad (lift iMonad x) k == k x} | VV == bind_lift iMonad}</span><span class='hs-varid'>bind_lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>133: </span>
<span class=hs-linenum>134: </span><span class='hs-comment'>-- Lemma.</span>
<span class=hs-linenum>135: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>136: </span><span class='hs-definition'>vseq_identity_right</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-varid'>iMonad</span><span class='hs-conop'>:</span><span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>137: </span>  <span class='hs-keyword'>{IsIdentityRight (vseq iMonad) (vseq_epsilon iMonad) m}</span>
<span class=hs-linenum>138: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>139: </span><span class='hs-definition'>vseq_identity_right</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span>
<span class=hs-linenum>140: </span><a class=annot href="#"><span class=annottext>forall a .
x1:(VMonad.VMonad a) -&gt; x2:a () -&gt; {VV : () | vseq x1 x2 (vseq_epsilon x1) == x2}</span><span class='hs-definition'>vseq_identity_right</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a ()</span><span class='hs-varid'>m</span></a> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>141: </span>  <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-varop'>&gt;&gt;</span> <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()
            &amp;&amp; v == vseq_epsilon_}</span><span class='hs-varid'>vseq_epsilon_</span></a>
<span class=hs-linenum>142: </span>    <span class='hs-varop'>==.</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:() -&gt; {v : a () | v == vconst vseq_epsilon_ x1
                     &amp;&amp; v == vseq_epsilon_}</span><span class='hs-varid'>vconst</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()
            &amp;&amp; v == vseq_epsilon_}</span><span class='hs-varid'>vseq_epsilon_</span></a>
<span class=hs-linenum>143: </span>    <span class='hs-varop'>==.</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>() -&gt; a ()</span><span class='hs-varid'>vconst</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == lift_ vunit}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>lift_</span> <a class=annot href="#"><span class=annottext>{v : () | v == ()
          &amp;&amp; v == vunit}</span><span class='hs-varid'>vunit</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>144: </span>    <span class='hs-varop'>==!</span> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-comment'>-- TODO: prove</span>
<span class=hs-linenum>145: </span>    <span class='hs-varop'>***</span> <a class=annot href="#"><span class=annottext>{v : Language.Haskell.Liquid.Equational.QED | v == QED}</span><span class='hs-conid'>QED</span></a>
<span class=hs-linenum>146: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>147: </span>    <a class=annot href="#"><span class=annottext>x1:a () -&gt; x2:a () -&gt; {v : a () | v == vseq iMonad x1 x2
                                  &amp;&amp; v == bind iMonad x1 (vconst x2)}</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:a () -&gt; x2:a () -&gt; {v : a () | v == vseq iMonad x1 x2
                                  &amp;&amp; v == bind iMonad x1 (vconst x2)}</span><span class='hs-varid'>vseq</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>148: </span>    <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()}</span><span class='hs-varid'>vseq_epsilon_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a () | v == vseq_epsilon iMonad
            &amp;&amp; v == lift iMonad ()}</span><span class='hs-varid'>vseq_epsilon</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>149: </span>    <a class=annot href="#"><span class=annottext>a () -&gt; (() -&gt; a ()) -&gt; a ()</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>150: </span>    <a class=annot href="#"><span class=annottext>() -&gt; a ()</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>151: </span>    <span class='hs-varid'>bind_identity_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bind_identity</span> <span class='hs-varid'>iMonad</span>
<span class=hs-linenum>152: </span>
<span class=hs-linenum>153: </span><span class='hs-comment'>-- Lemma.</span>
<span class=hs-linenum>154: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>155: </span><span class='hs-definition'>vseq_identity</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varop'>.</span> <span class='hs-varid'>iMonad</span><span class='hs-conop'>:</span><span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span><span class='hs-conop'>:</span><span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>156: </span>  <span class='hs-keyword'>{IsIdentity (vseq iMonad) (vseq_epsilon iMonad) m}</span>
<span class=hs-linenum>157: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>158: </span><span class='hs-definition'>vseq_identity</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>VUnit</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proof</span>
<span class=hs-linenum>159: </span><a class=annot href="#"><span class=annottext>forall a .
x1:(VMonad.VMonad a) -&gt; x2:a () -&gt; {VV : () | vseq x1 (vseq_epsilon x1) x2 == x2
                                              &amp;&amp; vseq x1 x2 (vseq_epsilon x1) == x2}</span><span class='hs-definition'>vseq_identity</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a ()</span><span class='hs-varid'>m</span></a> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>160: </span>  <a class=annot href="#"><span class=annottext>{v : () | vseq iMonad (vseq_epsilon iMonad) m == m
          &amp;&amp; v == vseq_identity_left iMonad m}</span><span class='hs-varid'>vseq_identity_left</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-varop'>&amp;&amp;&amp;</span> <a class=annot href="#"><span class=annottext>{v : () | vseq iMonad m (vseq_epsilon iMonad) == m
          &amp;&amp; v == vseq_identity_right iMonad m}</span><span class='hs-varid'>vseq_identity_right</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>{v : a () | v == m}</span><span class='hs-varid'>m</span></a>
<span class=hs-linenum>161: </span>
<span class=hs-linenum>162: </span><span class='hs-comment'>-- -- Lemma. Sequencing is associative.</span>
<span class=hs-linenum>163: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>164: </span><span class='hs-comment'>-- assume vseq_associative ::</span>
<span class=hs-linenum>165: </span><span class='hs-comment'>--   forall m a b c . iMonad:VMonad m -&gt; m1:m a -&gt; m2:m b -&gt; m3:m c -&gt;</span>
<span class=hs-linenum>166: </span><span class='hs-comment'>--   {peq (m c) (vseq iMonad m1 (vseq iMonad m2 m3)) (vseq iMonad (vseq iMonad m1 m2) m3)}</span>
<span class=hs-linenum>167: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>168: </span><span class='hs-comment'>-- vseq_associative :: forall m a b c. VMonad m -&gt; m a -&gt; m b -&gt; m c -&gt; PBEq (m c)</span>
<span class=hs-linenum>169: </span><span class='hs-comment'>-- vseq_associative iMonad m1 m2 m3 =</span>
<span class=hs-linenum>170: </span><span class='hs-comment'>--   m1 &gt;&gt; (m1 &gt;&gt; m2)</span>
<span class=hs-linenum>171: </span><span class='hs-comment'>--     ==* _</span>
<span class=hs-linenum>172: </span><span class='hs-comment'>--     ==* (m1 &gt;&gt; m2) &gt;&gt; m3</span>
<span class=hs-linenum>173: </span><span class='hs-comment'>--     *** QED</span>
<span class=hs-linenum>174: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>175: </span><span class='hs-comment'>--     (&gt;&gt;) :: forall a b. m a -&gt; m b -&gt; m b</span>
<span class=hs-linenum>176: </span><span class='hs-comment'>--     (&gt;&gt;) = vseq iMonad</span>
<span class=hs-linenum>177: </span><span class='hs-comment'>--     (&gt;&gt;=) :: forall a b. m a -&gt; (a -&gt; m b) -&gt; m b</span>
<span class=hs-linenum>178: </span><span class='hs-comment'>--     (&gt;&gt;=) = bind iMonad</span>
<span class=hs-linenum>179: </span><span class='hs-comment'>--     (&gt;=&gt;) = kleisli iMonad</span>
<span class=hs-linenum>180: </span>
<span class=hs-linenum>181: </span><span class='hs-comment'>-- TODO: trying to use PBEq (above)</span>
<span class=hs-linenum>182: </span><span class='hs-comment'>-- -- Lemma. Sequencing is associative.</span>
<span class=hs-linenum>183: </span><span class='hs-comment'>-- {-@ automatic-instances vseq_associative @-}</span>
<span class=hs-linenum>184: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>185: </span><span class='hs-comment'>-- vseq_associative ::</span>
<span class=hs-linenum>186: </span><span class='hs-comment'>--   forall m a b c . iMonad:VMonad m -&gt; m1:m a -&gt; m2:m b -&gt; m3:m c -&gt;</span>
<span class=hs-linenum>187: </span><span class='hs-comment'>--   {IsAssociative (vseq iMonad) m1 m2 m3}</span>
<span class=hs-linenum>188: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>189: </span><span class='hs-comment'>-- vseq_associative :: forall m a b c. VMonad m -&gt; m a -&gt; m b -&gt; m c -&gt; Proof</span>
<span class=hs-linenum>190: </span><span class='hs-comment'>-- vseq_associative iMonad m1 m2 m3 =</span>
<span class=hs-linenum>191: </span><span class='hs-comment'>--   m1 &gt;&gt; (m2 &gt;&gt; m3)</span>
<span class=hs-linenum>192: </span><span class='hs-comment'>--     -- [def] &gt;&gt;</span>
<span class=hs-linenum>193: </span><span class='hs-comment'>--     ==. m1 &gt;&gt;= vconst (m2 &gt;&gt;= vconst m3)</span>
<span class=hs-linenum>194: </span><span class='hs-comment'>--     ==. ( m1 &gt;&gt;= (vconst m2 &gt;=&gt; vconst m3)</span>
<span class=hs-linenum>195: </span><span class='hs-comment'>--             ? extensionality</span>
<span class=hs-linenum>196: </span><span class='hs-comment'>--               (vconst m2 &gt;=&gt; vconst m3)</span>
<span class=hs-linenum>197: </span><span class='hs-comment'>--               (vconst (m2 &gt;&gt;= vconst m3))</span>
<span class=hs-linenum>198: </span><span class='hs-comment'>--               (vseq_associative_lem1_ m2 m3)</span>
<span class=hs-linenum>199: </span><span class='hs-comment'>--         )</span>
<span class=hs-linenum>200: </span><span class='hs-comment'>--     -- [def] &gt;=&gt;</span>
<span class=hs-linenum>201: </span><span class='hs-comment'>--     -- TODO: [err] invalid subtype, but I can't tell why</span>
<span class=hs-linenum>202: </span><span class='hs-comment'>--     ==. ( (m1 &gt;&gt;= vconst m2) &gt;&gt;= vconst m3</span>
<span class=hs-linenum>203: </span><span class='hs-comment'>--             ? bind_associative_ m1 (vconst m2) (vconst m3)</span>
<span class=hs-linenum>204: </span><span class='hs-comment'>--         )</span>
<span class=hs-linenum>205: </span><span class='hs-comment'>--     -- [def] &gt;&gt;</span>
<span class=hs-linenum>206: </span><span class='hs-comment'>--     ==! (m1 &gt;&gt; m2) &gt;&gt; m3</span>
<span class=hs-linenum>207: </span><span class='hs-comment'>--     *** QED</span>
<span class=hs-linenum>208: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>209: </span><span class='hs-comment'>--     (&gt;&gt;) :: forall a b. m a -&gt; m b -&gt; m b</span>
<span class=hs-linenum>210: </span><span class='hs-comment'>--     (&gt;&gt;) = vseq iMonad</span>
<span class=hs-linenum>211: </span><span class='hs-comment'>--     (&gt;&gt;=) :: forall a b. m a -&gt; (a -&gt; m b) -&gt; m b</span>
<span class=hs-linenum>212: </span><span class='hs-comment'>--     (&gt;&gt;=) = bind iMonad</span>
<span class=hs-linenum>213: </span><span class='hs-comment'>--     (&gt;=&gt;) = kleisli iMonad</span>
<span class=hs-linenum>214: </span><span class='hs-comment'>--     bind_associative_ = bind_associative iMonad</span>
<span class=hs-linenum>215: </span><span class='hs-comment'>--     vseq_associative_lem1_ = vseq_associative_lem1 iMonad</span>
<span class=hs-linenum>216: </span>
<span class=hs-linenum>217: </span><span class='hs-comment'>-- {-@ automatic-instances vseq_associative_lem1 @-}</span>
<span class=hs-linenum>218: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>219: </span><span class='hs-comment'>-- vseq_associative_lem1 ::</span>
<span class=hs-linenum>220: </span><span class='hs-comment'>--   forall m a b c. iMonad:VMonad m -&gt; m2:m b -&gt; m3:m c -&gt; x:a -&gt;</span>
<span class=hs-linenum>221: </span><span class='hs-comment'>--   {kleisli iMonad (vconst m2) (vconst m3) x ==</span>
<span class=hs-linenum>222: </span><span class='hs-comment'>--    vconst (bind iMonad m2 (vconst m3)) x}</span>
<span class=hs-linenum>223: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>224: </span><span class='hs-comment'>-- vseq_associative_lem1 ::</span>
<span class=hs-linenum>225: </span><span class='hs-comment'>--   forall m a b c.</span>
<span class=hs-linenum>226: </span><span class='hs-comment'>--   VMonad m -&gt;</span>
<span class=hs-linenum>227: </span><span class='hs-comment'>--   m b -&gt;</span>
<span class=hs-linenum>228: </span><span class='hs-comment'>--   m c -&gt;</span>
<span class=hs-linenum>229: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>230: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>231: </span><span class='hs-comment'>-- vseq_associative_lem1 iMonad m2 m3 x =</span>
<span class=hs-linenum>232: </span><span class='hs-comment'>--   -- (vconst m2 &gt;=&gt; vconst m3) x</span>
<span class=hs-linenum>233: </span><span class='hs-comment'>--   (vconst m2 &gt;=&gt; vconst m3) x</span>
<span class=hs-linenum>234: </span><span class='hs-comment'>--     -- [def] &gt;=&gt;</span>
<span class=hs-linenum>235: </span><span class='hs-comment'>--     ==. vconst m2 x &gt;&gt;= vconst m3</span>
<span class=hs-linenum>236: </span><span class='hs-comment'>--     -- [def] vconst</span>
<span class=hs-linenum>237: </span><span class='hs-comment'>--     ==. m2 &gt;&gt;= vconst m3</span>
<span class=hs-linenum>238: </span><span class='hs-comment'>--     -- [def] vconst</span>
<span class=hs-linenum>239: </span><span class='hs-comment'>--     ==. vconst (m2 &gt;&gt;= vconst m3) x</span>
<span class=hs-linenum>240: </span><span class='hs-comment'>--     *** QED</span>
<span class=hs-linenum>241: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>242: </span><span class='hs-comment'>--     (&gt;&gt;=) = bind iMonad</span>
<span class=hs-linenum>243: </span><span class='hs-comment'>--     (&gt;=&gt;) = kleisli iMonad</span>
<span class=hs-linenum>244: </span><span class='hs-comment'>--     kleisli_ = kleisli iMonad</span>
<span class=hs-linenum>245: </span>
<span class=hs-linenum>246: </span><span class='hs-comment'>-- Function.</span>
<span class=hs-linenum>247: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vmapM</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>248: </span><span class='hs-definition'>vmapM</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>249: </span><a class=annot href="#"><span class=annottext>forall a b c .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; c) -&gt; x4:a b -&gt; {VV : a c | VV == vmapM x1 x2 x4
                                                             &amp;&amp; VV == bind x1 x4 (liftM_f x1 x2)}</span><span class='hs-definition'>vmapM</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>m</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a b | v == m}</span><span class='hs-varid'>m</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; {v : b c | v == liftM_f iMonad f x1
                   &amp;&amp; v == lift iMonad (f x1)}</span><span class='hs-varid'>liftM_f_</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b</span><span class='hs-varid'>f</span></a>
<span class=hs-linenum>250: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>251: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>252: </span>    <a class=annot href="#"><span class=annottext>x1:(a -&gt; b) -&gt; x3:a -&gt; {v : c b | v == liftM_f iMonad x1 x3
                                  &amp;&amp; v == lift iMonad (x1 x3)}</span><span class='hs-varid'>liftM_f_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(a -&gt; b) -&gt; x3:a -&gt; {v : c b | v == liftM_f iMonad x1 x3
                                  &amp;&amp; v == lift iMonad (x1 x3)}</span><span class='hs-varid'>liftM_f</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>253: </span>
<span class=hs-linenum>254: </span><span class='hs-definition'>vmapM_aux</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>255: </span><a class=annot href="#"><span class=annottext>forall a b c . (VMonad.VMonad a) -&gt; (b -&gt; c) -&gt; b -&gt; a c</span><span class='hs-definition'>vmapM_aux</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == f x}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>256: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>257: </span>    <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>258: </span>
<span class=hs-linenum>259: </span><span class='hs-comment'>-- Function.</span>
<span class=hs-linenum>260: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vmapM2</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>261: </span><span class='hs-definition'>vmapM2</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<span class=hs-linenum>262: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; c -&gt; d) -&gt; x5:a b -&gt; x6:a c -&gt; {VV : a d | VV == vmapM2 x1 x2 x5 x6
                                                                            &amp;&amp; VV == bind x1 x5 (vmapM2_aux1 x1 x2 x6)}</span><span class='hs-definition'>vmapM2</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b -&gt; c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>ma</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>mb</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a b | v == ma}</span><span class='hs-varid'>ma</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; {v : b c | v == vmapM2_aux1 iMonad f mb x1
                   &amp;&amp; v == bind iMonad mb (vmapM2_aux2 iMonad f x1)}</span><span class='hs-varid'>vmapM2_aux1_</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b -&gt; c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{v : a b | v == mb}</span><span class='hs-varid'>mb</span></a>
<span class=hs-linenum>263: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>264: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>265: </span>    <a class=annot href="#"><span class=annottext>x1:(a -&gt; b -&gt; c) -&gt; x4:d b -&gt; x5:a -&gt; {v : d c | v == vmapM2_aux1 iMonad x1 x4 x5
                                                 &amp;&amp; v == bind iMonad x4 (vmapM2_aux2 iMonad x1 x5)}</span><span class='hs-varid'>vmapM2_aux1_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(a -&gt; b -&gt; c) -&gt; x4:d b -&gt; x5:a -&gt; {v : d c | v == vmapM2_aux1 iMonad x1 x4 x5
                                                 &amp;&amp; v == bind iMonad x4 (vmapM2_aux2 iMonad x1 x5)}</span><span class='hs-varid'>vmapM2_aux1</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>266: </span>
<span class=hs-linenum>267: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vmapM2_aux1</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>268: </span><span class='hs-definition'>vmapM2_aux1</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<span class=hs-linenum>269: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; c -&gt; d) -&gt; x5:a c -&gt; x6:b -&gt; {VV : a d | VV == vmapM2_aux1 x1 x2 x5 x6
                                                                          &amp;&amp; VV == bind x1 x5 (vmapM2_aux2 x1 x2 x6)}</span><span class='hs-definition'>vmapM2_aux1</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b -&gt; c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a b</span><span class='hs-varid'>mb</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{v : a b | v == mb}</span><span class='hs-varid'>mb</span></a> <span class='hs-varop'>&gt;&gt;=</span> <a class=annot href="#"><span class=annottext>x1:a -&gt; {v : b c | v == vmapM2_aux2 iMonad f x x1
                   &amp;&amp; v == lift iMonad (f x x1)}</span><span class='hs-varid'>vmapM2_aux2_</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b -&gt; c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a>
<span class=hs-linenum>270: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>271: </span>    <span class='hs-varid'>lift_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varid'>iMonad</span>
<span class=hs-linenum>272: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a c) -&gt; a c</span><span class='hs-layout'>(</span></a><span class='hs-varop'>&gt;&gt;=</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>273: </span>    <a class=annot href="#"><span class=annottext>x1:(a -&gt; b -&gt; c) -&gt; x4:a -&gt; x5:b -&gt; {v : d c | v == vmapM2_aux2 iMonad x1 x4 x5
                                               &amp;&amp; v == lift iMonad (x1 x4 x5)}</span><span class='hs-varid'>vmapM2_aux2_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>x1:(a -&gt; b -&gt; c) -&gt; x4:a -&gt; x5:b -&gt; {v : d c | v == vmapM2_aux2 iMonad x1 x4 x5
                                               &amp;&amp; v == lift iMonad (x1 x4 x5)}</span><span class='hs-varid'>vmapM2_aux2</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>274: </span>
<span class=hs-linenum>275: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>vmapM2_aux2</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>276: </span><span class='hs-definition'>vmapM2_aux2</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span>
<span class=hs-linenum>277: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; c -&gt; d) -&gt; x5:b -&gt; x6:c -&gt; {VV : a d | VV == vmapM2_aux2 x1 x2 x5 x6
                                                                        &amp;&amp; VV == lift x1 (x2 x5 x6)}</span><span class='hs-definition'>vmapM2_aux2</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b -&gt; c</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>y</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == f x y}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == y}</span><span class='hs-varid'>y</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>278: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>279: </span>    <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>280: </span>
<span class=hs-linenum>281: </span><span class='hs-comment'>-- Predicate. Commutativity for monads.</span>
<span class=hs-linenum>282: </span><span class='hs-keyword'>{-@</span>
<span class=hs-linenum>283: </span><span class='hs-definition'>predicate</span> <span class='hs-conid'>IsCommutativeMonadic</span> <span class='hs-conid'>IMONAD</span> <span class='hs-conid'>M1</span> <span class='hs-conid'>M2</span> <span class='hs-conid'>F</span> <span class='hs-keyglyph'>=</span>
<span class=hs-linenum>284: </span>  <span class='hs-varid'>vmapM2</span> <span class='hs-conid'>IMONAD</span> <span class='hs-conid'>F</span> <span class='hs-conid'>M1</span> <span class='hs-conid'>M2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vmapM2</span> <span class='hs-conid'>IMONAD</span> <span class='hs-layout'>(</span><span class='hs-varid'>vflip</span> <span class='hs-conid'>F</span><span class='hs-layout'>)</span> <span class='hs-conid'>M2</span> <span class='hs-conid'>M1</span>
<span class=hs-linenum>285: </span><span class='hs-keyword'>@-}</span>
<span class=hs-linenum>286: </span>
<span class=hs-linenum>287: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>liftM_f</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>288: </span><span class='hs-definition'>liftM_f</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-varop'>.</span> <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<span class=hs-linenum>289: </span><a class=annot href="#"><span class=annottext>forall a b c .
x1:(VMonad.VMonad a) -&gt; x2:(b -&gt; c) -&gt; x4:b -&gt; {VV : a c | VV == liftM_f x1 x2 x4
                                                           &amp;&amp; VV == lift x1 (x2 x4)}</span><span class='hs-definition'>liftM_f</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>x</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <a class=annot href="#"><span class=annottext>{VV : a | VV == f x}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>290: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>291: </span>    <a class=annot href="#"><span class=annottext>a -&gt; b a</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>292: </span>
<span class=hs-linenum>293: </span><span class='hs-comment'>-- Function. Lifts tuple into monad, after applying a function to second</span>
<span class=hs-linenum>294: </span><span class='hs-comment'>-- component.</span>
<span class=hs-linenum>295: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>reflect</span> <span class='hs-varid'>liftM_f_second</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>296: </span><span class='hs-definition'>liftM_f_second</span> <span class='hs-keyglyph'>::</span>
<span class=hs-linenum>297: </span>  <span class='hs-keyword'>forall</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span><span class='hs-varop'>.</span>
<span class=hs-linenum>298: </span>  <span class='hs-conid'>VMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>299: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>300: </span>  <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>301: </span>  <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<span class=hs-linenum>302: </span><a class=annot href="#"><span class=annottext>forall a b c d .
x1:(VMonad.VMonad a) -&gt; x2:(c -&gt; a d) -&gt; x4:(b, c) -&gt; {VV : a (b, d) | VV == liftM_f_second x1 x2 x4
                                                                       &amp;&amp; VV == bind x1 (x2 (lqdc##$select x4)) lam y'##a58Y : d##xo . lift x1 ((,) (lqdc##$select x4) y'##a58Y)}</span><span class='hs-definition'>liftM_f_second</span></a> <a class=annot href="#"><span class=annottext>(VMonad.VMonad a)</span><span class='hs-varid'>iMonad</span></a> <a class=annot href="#"><span class=annottext>a -&gt; b c</span><span class='hs-varid'>f</span></a> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>a -&gt; b (c, a)</span><span class='hs-varid'>bind_</span></a> <a class=annot href="#"><span class=annottext>{v : a b | v == f y}</span><span class='hs-layout'>(</span></a><span class='hs-varid'>f</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == y}</span><span class='hs-varid'>y</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>(a, b) -&gt; c (a, b)</span><span class='hs-layout'>(</span></a><span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>a</span><span class='hs-varid'>y'</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>lift_</span> <a class=annot href="#"><span class=annottext>{v : (a, b) | x_Tuple22 v == y'
              &amp;&amp; x_Tuple21 v == x
              &amp;&amp; lqdc##$select v == y'
              &amp;&amp; lqdc##$select v == x
              &amp;&amp; snd v == y'
              &amp;&amp; fst v == x
              &amp;&amp; v == (,) x y'}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{VV : a | VV == x}</span><span class='hs-varid'>x</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV : a | VV == y'}</span><span class='hs-varid'>y'</span></a><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<span class=hs-linenum>303: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>304: </span>    <a class=annot href="#"><span class=annottext>(a, b) -&gt; c (a, b)</span><span class='hs-varid'>lift_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a . a -&gt; b a | VV == lift iMonad}</span><span class='hs-varid'>lift</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
<span class=hs-linenum>305: </span>    <a class=annot href="#"><span class=annottext>a b -&gt; (b -&gt; a (c, b)) -&gt; a (c, b)</span><span class='hs-varid'>bind_</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{VV : forall a b . c a -&gt; (a -&gt; c b) -&gt; c b | VV == bind iMonad}</span><span class='hs-varid'>bind</span></a> <a class=annot href="#"><span class=annottext>{v : (VMonad.VMonad a) | v == iMonad}</span><span class='hs-varid'>iMonad</span></a>
</pre>
</body>
</html>