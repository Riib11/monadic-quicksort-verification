<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>src/PartitionArray.hs</title>
</head>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>

<body>
<hr>
Put mouse over identifiers to see inferred types
<pre><span class=hs-linenum>  1: </span><a class=annot href="#"><span class=annottext>GHC.Types.Module</span><span class='hs-keyword'>module</span></a> <span class='hs-conid'>PartitionArray</span> <span class='hs-keyword'>where</span>
<span class=hs-linenum>  2: </span>
<span class=hs-linenum>  3: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Function</span>
<span class=hs-linenum>  4: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Language.Haskell.Liquid.ProofCombinators</span>
<span class=hs-linenum>  5: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>QuickSortList</span>
<span class=hs-linenum>  6: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>Relation</span>
<span class=hs-linenum>  7: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>SlowSortList</span>
<span class=hs-linenum>  8: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VList</span>
<span class=hs-linenum>  9: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VMonad</span>
<span class=hs-linenum> 10: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VMonadArray</span>
<span class=hs-linenum> 11: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VMonadPlus</span>
<span class=hs-linenum> 12: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VNat</span>
<span class=hs-linenum> 13: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VOrdered</span>
<span class=hs-linenum> 14: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VTuple</span>
<span class=hs-linenum> 15: </span><span class='hs-keyword'>import</span> <span class='hs-conid'>VUnit</span>
<span class=hs-linenum> 16: </span>
<span class=hs-linenum> 17: </span><span class='hs-comment'>-- -- TODO: What's the theorem here? Is it just that this implementation finally</span>
<span class=hs-linenum> 18: </span><span class='hs-comment'>-- -- shows `ipartl_specification1_correct` sound?</span>
<span class=hs-linenum> 19: </span>
<span class=hs-linenum> 20: </span><span class='hs-comment'>-- -- Type. VConstraints for nondeterministically sorting arrays.</span>
<span class=hs-linenum> 21: </span><span class='hs-comment'>-- type VMonadArrayPlusOrdered m a = (VMonadArray m a, VMonadPlus m, VOrdered a)</span>
<span class=hs-linenum> 22: </span>
<span class=hs-linenum> 23: </span><span class='hs-comment'>-- -- Function. Partition list `xs` onto two other lists `ys` and `zs` (not</span>
<span class=hs-linenum> 24: </span><span class='hs-comment'>-- -- tail-recursively) using `partition`.</span>
<span class=hs-linenum> 25: </span><span class='hs-comment'>-- {-@ reflect partl_ntr @-}</span>
<span class=hs-linenum> 26: </span><span class='hs-comment'>-- partl_ntr ::</span>
<span class=hs-linenum> 27: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 28: </span><span class='hs-comment'>--   VOrdered a -&gt;</span>
<span class=hs-linenum> 29: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum> 30: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum> 31: </span><span class='hs-comment'>--   VTuple2D (VList a)</span>
<span class=hs-linenum> 32: </span><span class='hs-comment'>-- partl_ntr iOrdered p (ys, zs, xs) =</span>
<span class=hs-linenum> 33: </span><span class='hs-comment'>--   let (us, vs) = partition_ p xs</span>
<span class=hs-linenum> 34: </span><span class='hs-comment'>--    in (vappend ys us, vappend zs vs)</span>
<span class=hs-linenum> 35: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum> 36: </span><span class='hs-comment'>--     partition_ = partition iOrdered</span>
<span class=hs-linenum> 37: </span>
<span class=hs-linenum> 38: </span><span class='hs-comment'>-- -- Function. Partition list `xs` onto two other lists `ys` and `zs`</span>
<span class=hs-linenum> 39: </span><span class='hs-comment'>-- -- (tail-recursively).</span>
<span class=hs-linenum> 40: </span><span class='hs-comment'>-- {-@ reflect partl @-}</span>
<span class=hs-linenum> 41: </span><span class='hs-comment'>-- partl ::</span>
<span class=hs-linenum> 42: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 43: </span><span class='hs-comment'>--   VOrdered a -&gt;</span>
<span class=hs-linenum> 44: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum> 45: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum> 46: </span><span class='hs-comment'>--   VTuple2D (VList a)</span>
<span class=hs-linenum> 47: </span><span class='hs-comment'>-- partl iOrdered p (ys, zs, VNil) = (ys, zs)</span>
<span class=hs-linenum> 48: </span><span class='hs-comment'>-- partl iOrdered p (ys, zs, VCons x xs) =</span>
<span class=hs-linenum> 49: </span><span class='hs-comment'>--   if vleq_ x p</span>
<span class=hs-linenum> 50: </span><span class='hs-comment'>--     then partl_ p (vappend ys (vsingleton x), zs, xs)</span>
<span class=hs-linenum> 51: </span><span class='hs-comment'>--     else partl_ p (ys, vappend zs (vsingleton x), xs)</span>
<span class=hs-linenum> 52: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum> 53: </span><span class='hs-comment'>--     partl_ = partl iOrdered</span>
<span class=hs-linenum> 54: </span><span class='hs-comment'>--     vleq_ = vleq iOrdered</span>
<span class=hs-linenum> 55: </span>
<span class=hs-linenum> 56: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum> 57: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum> 58: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum> 59: </span><span class='hs-comment'>-- assume partl_correct ::</span>
<span class=hs-linenum> 60: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 61: </span><span class='hs-comment'>--   iOrdered:VOrdered a -&gt;</span>
<span class=hs-linenum> 62: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum> 63: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum> 64: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum> 65: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum> 66: </span><span class='hs-comment'>--   {partl iOrdered p (ys, zs, xs) =</span>
<span class=hs-linenum> 67: </span><span class='hs-comment'>--    partl iOrdered p (ys, zs, xs)}</span>
<span class=hs-linenum> 68: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum> 69: </span><span class='hs-comment'>-- partl_correct ::</span>
<span class=hs-linenum> 70: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 71: </span><span class='hs-comment'>--   VOrdered a -&gt;</span>
<span class=hs-linenum> 72: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum> 73: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum> 74: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum> 75: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum> 76: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum> 77: </span><span class='hs-comment'>-- partl_correct iOrdered p xs ys zs = ()</span>
<span class=hs-linenum> 78: </span>
<span class=hs-linenum> 79: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum> 80: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum> 81: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum> 82: </span><span class='hs-comment'>-- assume partl_generalizes_partition ::</span>
<span class=hs-linenum> 83: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 84: </span><span class='hs-comment'>--   iOrdered:VOrdered a -&gt;</span>
<span class=hs-linenum> 85: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum> 86: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum> 87: </span><span class='hs-comment'>--   {partl iOrdered p (VNil, VNil, xs) = partition iOrdered p xs}</span>
<span class=hs-linenum> 88: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum> 89: </span><span class='hs-comment'>-- partl_generalizes_partition ::</span>
<span class=hs-linenum> 90: </span><span class='hs-comment'>--   forall a.</span>
<span class=hs-linenum> 91: </span><span class='hs-comment'>--   VOrdered a -&gt;</span>
<span class=hs-linenum> 92: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum> 93: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum> 94: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum> 95: </span><span class='hs-comment'>-- partl_generalizes_partition iOrdered p xs = ()</span>
<span class=hs-linenum> 96: </span>
<span class=hs-linenum> 97: </span><span class='hs-comment'>-- -- Function. Write components to array, then `ipartl` with respective lengths.</span>
<span class=hs-linenum> 98: </span><span class='hs-comment'>-- {-@ reflect ipartl' @-}</span>
<span class=hs-linenum> 99: </span><span class='hs-comment'>-- ipartl' ::</span>
<span class=hs-linenum>100: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>101: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>102: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>103: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>104: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum>105: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>106: </span><span class='hs-comment'>-- ipartl' (iMonadArray, iMonadPlus, iOrdered) p i (ys, zs, xs) =</span>
<span class=hs-linenum>107: </span><span class='hs-comment'>--   vseq_</span>
<span class=hs-linenum>108: </span><span class='hs-comment'>--     (vwriteList_ i (vappend ys (vappend zs xs)))</span>
<span class=hs-linenum>109: </span><span class='hs-comment'>--     (ipartl_ p i (vlength ys, vlength zs, vlength xs))</span>
<span class=hs-linenum>110: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>111: </span><span class='hs-comment'>--     vseq_ = vseq iMonad_</span>
<span class=hs-linenum>112: </span><span class='hs-comment'>--     vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>113: </span><span class='hs-comment'>--     ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>114: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>115: </span>
<span class=hs-linenum>116: </span><span class='hs-comment'>-- -- Specification. `ipartl'` specification #1 (page 10).</span>
<span class=hs-linenum>117: </span><span class='hs-comment'>-- {-@ reflect ipartl_specification1 @-}</span>
<span class=hs-linenum>118: </span><span class='hs-comment'>-- ipartl_specification1 ::</span>
<span class=hs-linenum>119: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>120: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>121: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>122: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>123: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum>124: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>125: </span><span class='hs-comment'>-- ipartl_specification1 (iMonadArray, iMonadPlus, iOrdered) p i (ys, zs, xs) =</span>
<span class=hs-linenum>126: </span><span class='hs-comment'>--   vbind_</span>
<span class=hs-linenum>127: </span><span class='hs-comment'>--     (vliftF_second_ permute_ (partl_ p (ys, zs, xs)))</span>
<span class=hs-linenum>128: </span><span class='hs-comment'>--     (vwriteListsToLengths2_ i)</span>
<span class=hs-linenum>129: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>130: </span><span class='hs-comment'>--     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>131: </span><span class='hs-comment'>--     vliftF_second_ = vliftF_second iMonad_</span>
<span class=hs-linenum>132: </span><span class='hs-comment'>--     permute_ = permute iMonadPlus</span>
<span class=hs-linenum>133: </span><span class='hs-comment'>--     partl_ = partl iOrdered</span>
<span class=hs-linenum>134: </span><span class='hs-comment'>--     vwriteListsToLengths2_ = vwriteListsToLengths2 iMonadArray</span>
<span class=hs-linenum>135: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>136: </span>
<span class=hs-linenum>137: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>138: </span><span class='hs-comment'>-- -- TODO: prove `ipartl` specification #1 is correct.</span>
<span class=hs-linenum>139: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>140: </span><span class='hs-comment'>-- assume ipartl_specification1_correct ::</span>
<span class=hs-linenum>141: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>142: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>143: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>144: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>145: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>146: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>147: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>148: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>149: </span><span class='hs-comment'>--     (ipartl' iMonadArrayPlusOrdered p i (ys, zs, xs))</span>
<span class=hs-linenum>150: </span><span class='hs-comment'>--     (ipartl_specification1 iMonadArrayPlusOrdered p i (ys, zs, xs))}</span>
<span class=hs-linenum>151: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>152: </span><span class='hs-comment'>-- ipartl_specification1_correct ::</span>
<span class=hs-linenum>153: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>154: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>155: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>156: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>157: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>158: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>159: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>160: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>161: </span><span class='hs-comment'>-- ipartl_specification1_correct iMonadArrayPlusOrdered p i xs ys zs = ()</span>
<span class=hs-linenum>162: </span>
<span class=hs-linenum>163: </span><span class='hs-comment'>-- -- TODO: how to handle this?</span>
<span class=hs-linenum>164: </span><span class='hs-comment'>-- -- -- NOTE: This implementation is not actually used. The actually used</span>
<span class=hs-linenum>165: </span><span class='hs-comment'>-- -- -- implementation is presented next.</span>
<span class=hs-linenum>166: </span><span class='hs-comment'>-- -- -- Function. Combining `vliftF_second` into `partl`.</span>
<span class=hs-linenum>167: </span><span class='hs-comment'>-- -- -- (viz page 10, Derivation)</span>
<span class=hs-linenum>168: </span><span class='hs-comment'>-- -- partl' ::</span>
<span class=hs-linenum>169: </span><span class='hs-comment'>-- --   forall m a.</span>
<span class=hs-linenum>170: </span><span class='hs-comment'>-- --   (VMonadPlus m, VOrdered a) -&gt;</span>
<span class=hs-linenum>171: </span><span class='hs-comment'>-- --   a -&gt;</span>
<span class=hs-linenum>172: </span><span class='hs-comment'>-- --   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum>173: </span><span class='hs-comment'>-- --   m (VTuple2D (VList a))</span>
<span class=hs-linenum>174: </span><span class='hs-comment'>-- -- partl' (iMonadPlus, iOrdered) p (ys, zs, VNil) = vlift_ (ys, zs)</span>
<span class=hs-linenum>175: </span><span class='hs-comment'>-- --   where</span>
<span class=hs-linenum>176: </span><span class='hs-comment'>-- --     vlift_ = vlift iMonad_</span>
<span class=hs-linenum>177: </span><span class='hs-comment'>-- --     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>178: </span><span class='hs-comment'>-- -- partl' (iMonadPlus, iOrdered) p (ys, zs, VCons x xs) =</span>
<span class=hs-linenum>179: </span><span class='hs-comment'>-- --   if vleq_ x p</span>
<span class=hs-linenum>180: </span><span class='hs-comment'>-- --     then</span>
<span class=hs-linenum>181: </span><span class='hs-comment'>-- --       vbind_</span>
<span class=hs-linenum>182: </span><span class='hs-comment'>-- --         (permute_ zs)</span>
<span class=hs-linenum>183: </span><span class='hs-comment'>-- --         (\zs' -&gt; partl'_ p (vappend ys (vsingleton x), zs', xs))</span>
<span class=hs-linenum>184: </span><span class='hs-comment'>-- --     else</span>
<span class=hs-linenum>185: </span><span class='hs-comment'>-- --       vbind_</span>
<span class=hs-linenum>186: </span><span class='hs-comment'>-- --         (permute (vappend zs (vsingleton x)))</span>
<span class=hs-linenum>187: </span><span class='hs-comment'>-- --         (\zs' -&gt; partl'_ p (ys, zs', xs))</span>
<span class=hs-linenum>188: </span><span class='hs-comment'>-- --   where</span>
<span class=hs-linenum>189: </span><span class='hs-comment'>-- --     vleq_ = vleq iOrdered</span>
<span class=hs-linenum>190: </span><span class='hs-comment'>-- --     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>191: </span><span class='hs-comment'>-- --     permute_ = permute iMonadPlus</span>
<span class=hs-linenum>192: </span><span class='hs-comment'>-- --     partl'_ = partl' (iMonadPlus, iOrdered)</span>
<span class=hs-linenum>193: </span><span class='hs-comment'>-- --     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>194: </span>
<span class=hs-linenum>195: </span><span class='hs-comment'>-- -- Function. Combining `vliftF_second` into `partl`. First version is</span>
<span class=hs-linenum>196: </span><span class='hs-comment'>-- -- presented as above, but below version is the implementation used onward</span>
<span class=hs-linenum>197: </span><span class='hs-comment'>-- -- (page 10, bottom).</span>
<span class=hs-linenum>198: </span><span class='hs-comment'>-- {-@ reflect partl' @-}</span>
<span class=hs-linenum>199: </span><span class='hs-comment'>-- partl' ::</span>
<span class=hs-linenum>200: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>201: </span><span class='hs-comment'>--   VMonadPlusOrdered m a -&gt;</span>
<span class=hs-linenum>202: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>203: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum>204: </span><span class='hs-comment'>--   m (VTuple2D (VList a))</span>
<span class=hs-linenum>205: </span><span class='hs-comment'>-- partl' (iMonadPlus, iOrdered) p (ys, zs, VNil) = vlift_ (ys, zs)</span>
<span class=hs-linenum>206: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>207: </span><span class='hs-comment'>--     vlift_ = vlift iMonad_</span>
<span class=hs-linenum>208: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>209: </span><span class='hs-comment'>-- partl' (iMonadPlus, iOrdered) p (ys, zs, VCons x xs) =</span>
<span class=hs-linenum>210: </span><span class='hs-comment'>--   vbind_</span>
<span class=hs-linenum>211: </span><span class='hs-comment'>--     (dispatch x p (ys, zs, xs))</span>
<span class=hs-linenum>212: </span><span class='hs-comment'>--     (partl'_ p)</span>
<span class=hs-linenum>213: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>214: </span><span class='hs-comment'>--     dispatch :: a -&gt; a -&gt; VTuple3D (VList a) -&gt; m (VTuple3D (VList a))</span>
<span class=hs-linenum>215: </span><span class='hs-comment'>--     dispatch x p (ys, zs, xs) =</span>
<span class=hs-linenum>216: </span><span class='hs-comment'>--       if vleq_ x p</span>
<span class=hs-linenum>217: </span><span class='hs-comment'>--         then</span>
<span class=hs-linenum>218: </span><span class='hs-comment'>--           vbind_</span>
<span class=hs-linenum>219: </span><span class='hs-comment'>--             (permute_ zs)</span>
<span class=hs-linenum>220: </span><span class='hs-comment'>--             (\zs' -&gt; vlift_ (vappend ys (vsingleton x), zs', xs))</span>
<span class=hs-linenum>221: </span><span class='hs-comment'>--         else</span>
<span class=hs-linenum>222: </span><span class='hs-comment'>--           vbind_</span>
<span class=hs-linenum>223: </span><span class='hs-comment'>--             (permute_ (vappend zs (vsingleton x)))</span>
<span class=hs-linenum>224: </span><span class='hs-comment'>--             (\zs' -&gt; vlift_ (ys, zs', xs))</span>
<span class=hs-linenum>225: </span>
<span class=hs-linenum>226: </span><span class='hs-comment'>--     vlift_ = vlift iMonad_</span>
<span class=hs-linenum>227: </span><span class='hs-comment'>--     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>228: </span><span class='hs-comment'>--     partl'_ = partl' (iMonadPlus, iOrdered)</span>
<span class=hs-linenum>229: </span><span class='hs-comment'>--     permute_ = permute iMonadPlus</span>
<span class=hs-linenum>230: </span><span class='hs-comment'>--     vleq_ = vleq iOrdered</span>
<span class=hs-linenum>231: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>232: </span>
<span class=hs-linenum>233: </span><span class='hs-comment'>-- -- Specification. `ipartl'` specification #2.</span>
<span class=hs-linenum>234: </span><span class='hs-comment'>-- -- (viz. page 10, display 10).</span>
<span class=hs-linenum>235: </span><span class='hs-comment'>-- {-@ reflect ipartl_specification2 @-}</span>
<span class=hs-linenum>236: </span><span class='hs-comment'>-- ipartl_specification2 ::</span>
<span class=hs-linenum>237: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>238: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>239: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>240: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>241: </span><span class='hs-comment'>--   VTuple3D (VList a) -&gt;</span>
<span class=hs-linenum>242: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>243: </span><span class='hs-comment'>-- ipartl_specification2 (iMonadArray, iMonadPlus, iOrdered) p i (ys, zs, xs) =</span>
<span class=hs-linenum>244: </span><span class='hs-comment'>--   vbind_</span>
<span class=hs-linenum>245: </span><span class='hs-comment'>--     (partl'_ p (ys, zs, xs))</span>
<span class=hs-linenum>246: </span><span class='hs-comment'>--     (vwriteListsToLengths2_ i)</span>
<span class=hs-linenum>247: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>248: </span><span class='hs-comment'>--     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>249: </span><span class='hs-comment'>--     partl'_ = partl' (iMonadPlus, iOrdered)</span>
<span class=hs-linenum>250: </span><span class='hs-comment'>--     vwriteListsToLengths2_ = vwriteListsToLengths2 iMonadArray</span>
<span class=hs-linenum>251: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>252: </span>
<span class=hs-linenum>253: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>254: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>255: </span><span class='hs-comment'>-- -- (viz. page 10, display 10).</span>
<span class=hs-linenum>256: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>257: </span><span class='hs-comment'>-- assume ipartl_specification2_correct ::</span>
<span class=hs-linenum>258: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>259: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a-&gt;</span>
<span class=hs-linenum>260: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>261: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>262: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>263: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>264: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>265: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>266: </span><span class='hs-comment'>--     (ipartl' iMonadArrayPlusOrdered p i (ys, zs, xs))</span>
<span class=hs-linenum>267: </span><span class='hs-comment'>--     (ipartl_specification2 iMonadArrayPlusOrdered p i (ys, zs, xs))}</span>
<span class=hs-linenum>268: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>269: </span><span class='hs-comment'>-- ipartl_specification2_correct ::</span>
<span class=hs-linenum>270: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>271: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>272: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>273: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>274: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>275: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>276: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>277: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>278: </span><span class='hs-comment'>-- ipartl_specification2_correct (iMonadArray, iMonadPlus, iOrdered) p i xs ys zs =</span>
<span class=hs-linenum>279: </span><span class='hs-comment'>--   ()</span>
<span class=hs-linenum>280: </span>
<span class=hs-linenum>281: </span><span class='hs-comment'>-- -- Specification. For the `then` branch in `ipartl_VCons_specification3`.</span>
<span class=hs-linenum>282: </span><span class='hs-comment'>-- -- (viz. page 11, )</span>
<span class=hs-linenum>283: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_then_specification3 @-}</span>
<span class=hs-linenum>284: </span><span class='hs-comment'>-- ipartl_VCons_then_specification3 ::</span>
<span class=hs-linenum>285: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>286: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>287: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>288: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>289: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>290: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>291: </span><span class='hs-comment'>-- ipartl_VCons_then_specification3</span>
<span class=hs-linenum>292: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>293: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>294: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>295: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>296: </span><span class='hs-comment'>--     vbind_</span>
<span class=hs-linenum>297: </span><span class='hs-comment'>--       (permute_ zs)</span>
<span class=hs-linenum>298: </span><span class='hs-comment'>--       ( \zs' -&gt;</span>
<span class=hs-linenum>299: </span><span class='hs-comment'>--           vseq_</span>
<span class=hs-linenum>300: </span><span class='hs-comment'>--             (vwriteList_ i (vappend ys (vappend (vsingleton x) zs')))</span>
<span class=hs-linenum>301: </span><span class='hs-comment'>--             (ipartl_ p i (Suc ys_l, vlength zs', xs_l))</span>
<span class=hs-linenum>302: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>303: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>304: </span><span class='hs-comment'>--       (xs_l, ys_l) = (vlength xs, vlength ys)</span>
<span class=hs-linenum>305: </span><span class='hs-comment'>--       vbind_ = vbind iMonad_</span>
<span class=hs-linenum>306: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>307: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>308: </span><span class='hs-comment'>--       permute_ = permute iMonadPlus</span>
<span class=hs-linenum>309: </span><span class='hs-comment'>--       ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>310: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>311: </span>
<span class=hs-linenum>312: </span><span class='hs-comment'>-- -- Specification. For the `else` branch in `ipartl_VCons_specification3`.</span>
<span class=hs-linenum>313: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_else_specification3 @-}</span>
<span class=hs-linenum>314: </span><span class='hs-comment'>-- ipartl_VCons_else_specification3 ::</span>
<span class=hs-linenum>315: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>316: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>317: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>318: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>319: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>320: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>321: </span><span class='hs-comment'>-- ipartl_VCons_else_specification3</span>
<span class=hs-linenum>322: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>323: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>324: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>325: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>326: </span><span class='hs-comment'>--     vbind_</span>
<span class=hs-linenum>327: </span><span class='hs-comment'>--       (permute_ (vappend zs (vsingleton x)))</span>
<span class=hs-linenum>328: </span><span class='hs-comment'>--       ( \zs' -&gt;</span>
<span class=hs-linenum>329: </span><span class='hs-comment'>--           vseq_</span>
<span class=hs-linenum>330: </span><span class='hs-comment'>--             (vlift_ (ys, zs', xs))</span>
<span class=hs-linenum>331: </span><span class='hs-comment'>--             (ipartl_ p i (ys_l, vlength zs', xs_l))</span>
<span class=hs-linenum>332: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>333: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>334: </span><span class='hs-comment'>--       (xs_l, ys_l) = (vlength xs, vlength ys)</span>
<span class=hs-linenum>335: </span><span class='hs-comment'>--       vlift_ = vlift iMonad_</span>
<span class=hs-linenum>336: </span><span class='hs-comment'>--       vbind_ = vbind iMonad_</span>
<span class=hs-linenum>337: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>338: </span><span class='hs-comment'>--       permute_ = permute iMonadPlus</span>
<span class=hs-linenum>339: </span><span class='hs-comment'>--       ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>340: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>341: </span>
<span class=hs-linenum>342: </span><span class='hs-comment'>-- -- Specification. For `ipartl'` applied to a `xs = VCons ...`.</span>
<span class=hs-linenum>343: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_specification3 @-}</span>
<span class=hs-linenum>344: </span><span class='hs-comment'>-- ipartl_VCons_specification3 ::</span>
<span class=hs-linenum>345: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>346: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>347: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>348: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>349: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>350: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>351: </span><span class='hs-comment'>-- ipartl_VCons_specification3</span>
<span class=hs-linenum>352: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>353: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>354: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>355: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>356: </span><span class='hs-comment'>--     vseq_</span>
<span class=hs-linenum>357: </span><span class='hs-comment'>--       (vwriteList_ (vadd i (vadd ys_l (vadd zs_l vone))) xs)</span>
<span class=hs-linenum>358: </span><span class='hs-comment'>--       ( if vleq_ x p</span>
<span class=hs-linenum>359: </span><span class='hs-comment'>--           then ipartl_VCons_then_specification3_</span>
<span class=hs-linenum>360: </span><span class='hs-comment'>--           else ipartl_VCons_else_specification3_</span>
<span class=hs-linenum>361: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>362: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>363: </span><span class='hs-comment'>--       (xs_l, ys_l, zs_l) = (vlength xs, vlength ys, vlength zs)</span>
<span class=hs-linenum>364: </span><span class='hs-comment'>--       ipartl_VCons_then_specification3_ =</span>
<span class=hs-linenum>365: </span><span class='hs-comment'>--         ipartl_VCons_then_specification3</span>
<span class=hs-linenum>366: </span><span class='hs-comment'>--           (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>367: </span><span class='hs-comment'>--           p</span>
<span class=hs-linenum>368: </span><span class='hs-comment'>--           i</span>
<span class=hs-linenum>369: </span><span class='hs-comment'>--           (ys, zs, x, xs)</span>
<span class=hs-linenum>370: </span><span class='hs-comment'>--       ipartl_VCons_else_specification3_ =</span>
<span class=hs-linenum>371: </span><span class='hs-comment'>--         ipartl_VCons_else_specification3</span>
<span class=hs-linenum>372: </span><span class='hs-comment'>--           (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>373: </span><span class='hs-comment'>--           p</span>
<span class=hs-linenum>374: </span><span class='hs-comment'>--           i</span>
<span class=hs-linenum>375: </span><span class='hs-comment'>--           (ys, zs, x, xs)</span>
<span class=hs-linenum>376: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>377: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>378: </span><span class='hs-comment'>--       vleq_ = vleq iOrdered</span>
<span class=hs-linenum>379: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>380: </span>
<span class=hs-linenum>381: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>382: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>383: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>384: </span><span class='hs-comment'>-- assume ipartl_VCons_specification3_correct ::</span>
<span class=hs-linenum>385: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>386: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>387: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>388: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>389: </span><span class='hs-comment'>--   x:a -&gt;</span>
<span class=hs-linenum>390: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>391: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>392: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>393: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>394: </span><span class='hs-comment'>--     (ipartl_VCons_specification3 iMonadArrayPlusOrdered p i (ys, zs, x, xs))</span>
<span class=hs-linenum>395: </span><span class='hs-comment'>--     (ipartl_specification2 iMonadArrayPlusOrdered p i (ys, zs, VCons x xs))}</span>
<span class=hs-linenum>396: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>397: </span><span class='hs-comment'>-- ipartl_VCons_specification3_correct ::</span>
<span class=hs-linenum>398: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>399: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>400: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>401: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>402: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>403: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>404: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>405: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>406: </span><span class='hs-comment'>-- ipartl_VCons_specification3_correct iMonadArrayPlusOrdered p i x xs ys zs = ()</span>
<span class=hs-linenum>407: </span>
<span class=hs-linenum>408: </span><span class='hs-comment'>-- -- Specification. For the `then` branch in `iparlt'` applied to a</span>
<span class=hs-linenum>409: </span><span class='hs-comment'>-- -- `xs = VCons ...`.</span>
<span class=hs-linenum>410: </span><span class='hs-comment'>-- -- (viz. page 11, bottom refinement).</span>
<span class=hs-linenum>411: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_then_specification4 @-}</span>
<span class=hs-linenum>412: </span><span class='hs-comment'>-- ipartl_VCons_then_specification4 ::</span>
<span class=hs-linenum>413: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>414: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>415: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>416: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>417: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>418: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>419: </span><span class='hs-comment'>-- ipartl_VCons_then_specification4</span>
<span class=hs-linenum>420: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>421: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>422: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>423: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>424: </span><span class='hs-comment'>--     vseq_</span>
<span class=hs-linenum>425: </span><span class='hs-comment'>--       (vwriteList_ i (vappend ys (vappend zs (vsingleton x))))</span>
<span class=hs-linenum>426: </span><span class='hs-comment'>--       ( vseq_</span>
<span class=hs-linenum>427: </span><span class='hs-comment'>--           (vswap_ (vadd i ys_l) (vadd i (vadd ys_l zs_l)))</span>
<span class=hs-linenum>428: </span><span class='hs-comment'>--           (ipartl_ p i (Suc ys_l, zs_l, xs_l))</span>
<span class=hs-linenum>429: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>430: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>431: </span><span class='hs-comment'>--       (ys_l, zs_l, xs_l) = (vlength ys, vlength zs, vlength xs)</span>
<span class=hs-linenum>432: </span><span class='hs-comment'>--       vswap_ = vswap iMonadArray</span>
<span class=hs-linenum>433: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>434: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>435: </span><span class='hs-comment'>--       ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>436: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>437: </span>
<span class=hs-linenum>438: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>439: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>440: </span><span class='hs-comment'>-- -- Uses lemma from page 12, display 11.</span>
<span class=hs-linenum>441: </span><span class='hs-comment'>-- -- (viz. page 11, bottom refinement).</span>
<span class=hs-linenum>442: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>443: </span><span class='hs-comment'>-- assume ipartl_VCons_then_specification4_correct ::</span>
<span class=hs-linenum>444: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>445: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>446: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>447: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>448: </span><span class='hs-comment'>--   x:a -&gt;</span>
<span class=hs-linenum>449: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>450: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>451: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>452: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>453: </span><span class='hs-comment'>--     (ipartl_VCons_then_specification4 iMonadArrayPlusOrdered p i (ys, zs, x, xs))</span>
<span class=hs-linenum>454: </span><span class='hs-comment'>--     (ipartl_VCons_then_specification3 iMonadArrayPlusOrdered p i (ys, zs, x, xs))}</span>
<span class=hs-linenum>455: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>456: </span><span class='hs-comment'>-- ipartl_VCons_then_specification4_correct ::</span>
<span class=hs-linenum>457: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>458: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>459: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>460: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>461: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>462: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>463: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>464: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>465: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>466: </span><span class='hs-comment'>-- ipartl_VCons_then_specification4_correct iMonadArrayPlusOrdered p i x xs ys zs =</span>
<span class=hs-linenum>467: </span><span class='hs-comment'>--   ()</span>
<span class=hs-linenum>468: </span>
<span class=hs-linenum>469: </span><span class='hs-comment'>-- -- Specification. For the `else` branch in `ipartl'` applied to a</span>
<span class=hs-linenum>470: </span><span class='hs-comment'>-- -- `xs = VCons ...`. Note that `vlift vunit` refines `permute`.</span>
<span class=hs-linenum>471: </span><span class='hs-comment'>-- -- (viz. page 11, middle refinement).</span>
<span class=hs-linenum>472: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_else_specification4 @-}</span>
<span class=hs-linenum>473: </span><span class='hs-comment'>-- ipartl_VCons_else_specification4 ::</span>
<span class=hs-linenum>474: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>475: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>476: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>477: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>478: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>479: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>480: </span><span class='hs-comment'>-- ipartl_VCons_else_specification4</span>
<span class=hs-linenum>481: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>482: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>483: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>484: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>485: </span><span class='hs-comment'>--     vseq_</span>
<span class=hs-linenum>486: </span><span class='hs-comment'>--       (vwriteList_ i (vappend ys (vappend zs (vsingleton x))))</span>
<span class=hs-linenum>487: </span><span class='hs-comment'>--       (ipartl_ p i (ys_l, Suc zs_l, xs_l))</span>
<span class=hs-linenum>488: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>489: </span><span class='hs-comment'>--       (ys_l, zs_l, xs_l) = (vlength ys, vlength zs, vlength xs)</span>
<span class=hs-linenum>490: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>491: </span><span class='hs-comment'>--       ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>492: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>493: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>494: </span>
<span class=hs-linenum>495: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>496: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>497: </span><span class='hs-comment'>-- -- Uses lemma from page 12, display 11.</span>
<span class=hs-linenum>498: </span><span class='hs-comment'>-- -- (viz. page 11, middle refinement).</span>
<span class=hs-linenum>499: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>500: </span><span class='hs-comment'>-- assume ipartl_VCons_else_specification4_correct ::</span>
<span class=hs-linenum>501: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>502: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>503: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>504: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>505: </span><span class='hs-comment'>--   x:a -&gt;</span>
<span class=hs-linenum>506: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>507: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>508: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>509: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>510: </span><span class='hs-comment'>--     (ipartl_VCons_else_specification4 iMonadArrayPlusOrdered p i (ys, zs, x, xs))</span>
<span class=hs-linenum>511: </span><span class='hs-comment'>--     (ipartl_VCons_else_specification3 iMonadArrayPlusOrdered p i (ys, zs, x, xs))</span>
<span class=hs-linenum>512: </span><span class='hs-comment'>--   }</span>
<span class=hs-linenum>513: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>514: </span><span class='hs-comment'>-- ipartl_VCons_else_specification4_correct ::</span>
<span class=hs-linenum>515: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>516: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>517: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>518: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>519: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>520: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>521: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>522: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>523: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>524: </span><span class='hs-comment'>-- ipartl_VCons_else_specification4_correct</span>
<span class=hs-linenum>525: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>526: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>527: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>528: </span><span class='hs-comment'>--   x</span>
<span class=hs-linenum>529: </span><span class='hs-comment'>--   xs</span>
<span class=hs-linenum>530: </span><span class='hs-comment'>--   ys</span>
<span class=hs-linenum>531: </span><span class='hs-comment'>--   zs =</span>
<span class=hs-linenum>532: </span><span class='hs-comment'>--     ()</span>
<span class=hs-linenum>533: </span>
<span class=hs-linenum>534: </span><span class='hs-comment'>-- {-@ reflect refinement11_greater @-}</span>
<span class=hs-linenum>535: </span><span class='hs-comment'>-- refinement11_greater ::</span>
<span class=hs-linenum>536: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>537: </span><span class='hs-comment'>--   VNat -&gt;</span>
<span class=hs-linenum>538: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>539: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>540: </span><span class='hs-comment'>--   m VUnit</span>
<span class=hs-linenum>541: </span><span class='hs-comment'>-- refinement11_greater (iMonadArray, iMonadPlus, iOrdered) i x zs =</span>
<span class=hs-linenum>542: </span><span class='hs-comment'>--   vbind_</span>
<span class=hs-linenum>543: </span><span class='hs-comment'>--     (permute_ zs)</span>
<span class=hs-linenum>544: </span><span class='hs-comment'>--     (\zs' -&gt; vwriteList_ i (vappend (vsingleton x) zs'))</span>
<span class=hs-linenum>545: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>546: </span><span class='hs-comment'>--     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>547: </span><span class='hs-comment'>--     permute_ = permute iMonadPlus</span>
<span class=hs-linenum>548: </span><span class='hs-comment'>--     vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>549: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>550: </span>
<span class=hs-linenum>551: </span><span class='hs-comment'>-- {-@ reflect refinement11_lesser @-}</span>
<span class=hs-linenum>552: </span><span class='hs-comment'>-- refinement11_lesser ::</span>
<span class=hs-linenum>553: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>554: </span><span class='hs-comment'>--   VNat -&gt;</span>
<span class=hs-linenum>555: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>556: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>557: </span><span class='hs-comment'>--   m VUnit</span>
<span class=hs-linenum>558: </span><span class='hs-comment'>-- refinement11_lesser (iMonadArray, iMonadPlus, iOrdered) i x zs =</span>
<span class=hs-linenum>559: </span><span class='hs-comment'>--   vseq_</span>
<span class=hs-linenum>560: </span><span class='hs-comment'>--     (vwriteList_ i (vappend zs (vsingleton x)))</span>
<span class=hs-linenum>561: </span><span class='hs-comment'>--     (vswap_ i (vadd i zs_l))</span>
<span class=hs-linenum>562: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>563: </span><span class='hs-comment'>--     zs_l = vlength zs</span>
<span class=hs-linenum>564: </span><span class='hs-comment'>--     vseq_ = vseq iMonad_</span>
<span class=hs-linenum>565: </span><span class='hs-comment'>--     vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>566: </span><span class='hs-comment'>--     vswap_ = vswap iMonadArray</span>
<span class=hs-linenum>567: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>568: </span>
<span class=hs-linenum>569: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>570: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>571: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>572: </span><span class='hs-comment'>-- assume refinement11 ::</span>
<span class=hs-linenum>573: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>574: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>575: </span><span class='hs-comment'>--   i:VNat -&gt;</span>
<span class=hs-linenum>576: </span><span class='hs-comment'>--   x:a -&gt;</span>
<span class=hs-linenum>577: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>578: </span><span class='hs-comment'>--   {RefinesPlusMonadic (snd3 iMonadArrayPlusOrdered)</span>
<span class=hs-linenum>579: </span><span class='hs-comment'>--     (refinement11_lesser iMonadArrayPlusOrdered i x zs)</span>
<span class=hs-linenum>580: </span><span class='hs-comment'>--     (refinement11_greater iMonadArrayPlusOrdered i x zs)}</span>
<span class=hs-linenum>581: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>582: </span><span class='hs-comment'>-- refinement11 ::</span>
<span class=hs-linenum>583: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>584: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>585: </span><span class='hs-comment'>--   VNat -&gt;</span>
<span class=hs-linenum>586: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>587: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>588: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>589: </span><span class='hs-comment'>-- refinement11 (iMonadArray, iMonadPlus, iOrdered) i x zs = ()</span>
<span class=hs-linenum>590: </span>
<span class=hs-linenum>591: </span><span class='hs-comment'>-- -- Specification. For `ipartl'` applied to a `xs = VCons ...`.</span>
<span class=hs-linenum>592: </span><span class='hs-comment'>-- -- (viz page 12, middle display)</span>
<span class=hs-linenum>593: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_specification4 @-}</span>
<span class=hs-linenum>594: </span><span class='hs-comment'>-- ipartl_VCons_specification4 ::</span>
<span class=hs-linenum>595: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>596: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>597: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>598: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>599: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>600: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>601: </span><span class='hs-comment'>-- ipartl_VCons_specification4</span>
<span class=hs-linenum>602: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>603: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>604: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>605: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>606: </span><span class='hs-comment'>--     vseq_</span>
<span class=hs-linenum>607: </span><span class='hs-comment'>--       (vwriteList_ (vadd i (vadd ys_l (Suc zs_l))) xs)</span>
<span class=hs-linenum>608: </span><span class='hs-comment'>--       ( if vleq_ x p</span>
<span class=hs-linenum>609: </span><span class='hs-comment'>--           then ipartl_VCons_then_specification4_</span>
<span class=hs-linenum>610: </span><span class='hs-comment'>--           else ipartl_VCons_else_specification4_</span>
<span class=hs-linenum>611: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>612: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>613: </span><span class='hs-comment'>--       (ys_l, zs_l, xs_l) = (vlength ys, vlength zs, vlength xs)</span>
<span class=hs-linenum>614: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>615: </span><span class='hs-comment'>--       vleq_ = vleq iOrdered</span>
<span class=hs-linenum>616: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>617: </span><span class='hs-comment'>--       ipartl_VCons_then_specification4_ =</span>
<span class=hs-linenum>618: </span><span class='hs-comment'>--         ipartl_VCons_then_specification4</span>
<span class=hs-linenum>619: </span><span class='hs-comment'>--           (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>620: </span><span class='hs-comment'>--           p</span>
<span class=hs-linenum>621: </span><span class='hs-comment'>--           i</span>
<span class=hs-linenum>622: </span><span class='hs-comment'>--           (ys, zs, x, xs)</span>
<span class=hs-linenum>623: </span><span class='hs-comment'>--       ipartl_VCons_else_specification4_ =</span>
<span class=hs-linenum>624: </span><span class='hs-comment'>--         ipartl_VCons_else_specification4</span>
<span class=hs-linenum>625: </span><span class='hs-comment'>--           (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>626: </span><span class='hs-comment'>--           p</span>
<span class=hs-linenum>627: </span><span class='hs-comment'>--           i</span>
<span class=hs-linenum>628: </span><span class='hs-comment'>--           (ys, zs, x, xs)</span>
<span class=hs-linenum>629: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>630: </span>
<span class=hs-linenum>631: </span><span class='hs-comment'>-- -- Specification. For `ipartl'` applied to a `xs = VCons ...`.</span>
<span class=hs-linenum>632: </span><span class='hs-comment'>-- -- (viz. page 12, middle refinements, bottom).</span>
<span class=hs-linenum>633: </span><span class='hs-comment'>-- {-@ reflect ipartl_VCons_specification5 @-}</span>
<span class=hs-linenum>634: </span><span class='hs-comment'>-- ipartl_VCons_specification5 ::</span>
<span class=hs-linenum>635: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>636: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>637: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>638: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>639: </span><span class='hs-comment'>--   (VList a, VList a, a, VList a) -&gt;</span>
<span class=hs-linenum>640: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>641: </span><span class='hs-comment'>-- ipartl_VCons_specification5</span>
<span class=hs-linenum>642: </span><span class='hs-comment'>--   (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>643: </span><span class='hs-comment'>--   p</span>
<span class=hs-linenum>644: </span><span class='hs-comment'>--   i</span>
<span class=hs-linenum>645: </span><span class='hs-comment'>--   (ys, zs, x, xs) =</span>
<span class=hs-linenum>646: </span><span class='hs-comment'>--     vseq_</span>
<span class=hs-linenum>647: </span><span class='hs-comment'>--       (vwriteList_ i (vappend ys (vappend zs (VCons x xs))))</span>
<span class=hs-linenum>648: </span><span class='hs-comment'>--       ( vbind_</span>
<span class=hs-linenum>649: </span><span class='hs-comment'>--           (vread_ (vadd i (vadd ys_l zs_l)))</span>
<span class=hs-linenum>650: </span><span class='hs-comment'>--           ( \x' -&gt;</span>
<span class=hs-linenum>651: </span><span class='hs-comment'>--               if vleq_ x' p</span>
<span class=hs-linenum>652: </span><span class='hs-comment'>--                 then</span>
<span class=hs-linenum>653: </span><span class='hs-comment'>--                   vseq_</span>
<span class=hs-linenum>654: </span><span class='hs-comment'>--                     (vswap_ (vadd i ys_l) (vadd i (vadd ys_l zs_l)))</span>
<span class=hs-linenum>655: </span><span class='hs-comment'>--                     (ipartl_ p i (Suc ys_l, zs_l, xs_l))</span>
<span class=hs-linenum>656: </span><span class='hs-comment'>--                 else (ipartl_ p i (ys_l, vadd zs_l vone, xs_l))</span>
<span class=hs-linenum>657: </span><span class='hs-comment'>--           )</span>
<span class=hs-linenum>658: </span><span class='hs-comment'>--       )</span>
<span class=hs-linenum>659: </span><span class='hs-comment'>--     where</span>
<span class=hs-linenum>660: </span><span class='hs-comment'>--       (ys_l, zs_l, xs_l) = (vlength ys, vlength zs, vlength xs)</span>
<span class=hs-linenum>661: </span><span class='hs-comment'>--       vseq_ = vseq iMonad_</span>
<span class=hs-linenum>662: </span><span class='hs-comment'>--       vbind_ = vbind iMonad_</span>
<span class=hs-linenum>663: </span><span class='hs-comment'>--       vleq_ = vleq iOrdered</span>
<span class=hs-linenum>664: </span><span class='hs-comment'>--       vread_ = vread iMonadArray</span>
<span class=hs-linenum>665: </span><span class='hs-comment'>--       vwriteList_ = vwriteList iMonadArray</span>
<span class=hs-linenum>666: </span><span class='hs-comment'>--       vswap_ = vswap iMonadArray</span>
<span class=hs-linenum>667: </span><span class='hs-comment'>--       ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>668: </span><span class='hs-comment'>--       iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>669: </span>
<span class=hs-linenum>670: </span><span class='hs-comment'>-- -- Lemma.</span>
<span class=hs-linenum>671: </span><span class='hs-comment'>-- -- TODO: prove</span>
<span class=hs-linenum>672: </span><span class='hs-comment'>-- -- NOTE: If I use a single `=` and indent the refinement type to look nice, I</span>
<span class=hs-linenum>673: </span><span class='hs-comment'>-- -- get an error with that says `ipartl_VCons_specification5` is an undefined</span>
<span class=hs-linenum>674: </span><span class='hs-comment'>-- -- symbol; I guess it thinks that I'm trying to do an assignment if I indent</span>
<span class=hs-linenum>675: </span><span class='hs-comment'>-- -- after an `=`?</span>
<span class=hs-linenum>676: </span><span class='hs-comment'>-- -- (viz. page 12, middle refinements).</span>
<span class=hs-linenum>677: </span><span class='hs-comment'>-- {-@</span>
<span class=hs-linenum>678: </span><span class='hs-comment'>-- assume ipartl_VCons_specification5_correct ::</span>
<span class=hs-linenum>679: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>680: </span><span class='hs-comment'>--   iMonadArrayPlusOrdered:VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>681: </span><span class='hs-comment'>--   p:a -&gt;</span>
<span class=hs-linenum>682: </span><span class='hs-comment'>--   i:Index -&gt;</span>
<span class=hs-linenum>683: </span><span class='hs-comment'>--   x:a -&gt;</span>
<span class=hs-linenum>684: </span><span class='hs-comment'>--   xs:VList a -&gt;</span>
<span class=hs-linenum>685: </span><span class='hs-comment'>--   ys:VList a -&gt;</span>
<span class=hs-linenum>686: </span><span class='hs-comment'>--   zs:VList a -&gt;</span>
<span class=hs-linenum>687: </span><span class='hs-comment'>--   {ipartl_VCons_specification5 iMonadArrayPlusOrdered p i (ys, zs, x, xs) ==</span>
<span class=hs-linenum>688: </span><span class='hs-comment'>--    ipartl_VCons_specification4 iMonadArrayPlusOrdered p i (ys, zs, x, xs)}</span>
<span class=hs-linenum>689: </span><span class='hs-comment'>-- @-}</span>
<span class=hs-linenum>690: </span><span class='hs-comment'>-- ipartl_VCons_specification5_correct ::</span>
<span class=hs-linenum>691: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>692: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>693: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>694: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>695: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>696: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>697: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>698: </span><span class='hs-comment'>--   VList a -&gt;</span>
<span class=hs-linenum>699: </span><span class='hs-comment'>--   Proof</span>
<span class=hs-linenum>700: </span><span class='hs-comment'>-- ipartl_VCons_specification5_correct iMonadArrayPlusOrdered p i x xs ys zs = ()</span>
<span class=hs-linenum>701: </span>
<span class=hs-linenum>702: </span><span class='hs-comment'>-- -- Function. Final deriviation of `ipartl`.</span>
<span class=hs-linenum>703: </span><span class='hs-comment'>-- {-@ reflect ipartl @-}</span>
<span class=hs-linenum>704: </span><span class='hs-comment'>-- ipartl ::</span>
<span class=hs-linenum>705: </span><span class='hs-comment'>--   forall m a.</span>
<span class=hs-linenum>706: </span><span class='hs-comment'>--   VMonadArrayPlusOrdered m a -&gt;</span>
<span class=hs-linenum>707: </span><span class='hs-comment'>--   a -&gt;</span>
<span class=hs-linenum>708: </span><span class='hs-comment'>--   Index -&gt;</span>
<span class=hs-linenum>709: </span><span class='hs-comment'>--   VTuple3D VNat -&gt;</span>
<span class=hs-linenum>710: </span><span class='hs-comment'>--   m (VTuple2D VNat)</span>
<span class=hs-linenum>711: </span><span class='hs-comment'>-- ipartl (iMonadArray, iMonadPlus, iOrdered) p i (ys_l, zs_l, Zero) =</span>
<span class=hs-linenum>712: </span><span class='hs-comment'>--   vlift_ (ys_l, zs_l)</span>
<span class=hs-linenum>713: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>714: </span><span class='hs-comment'>--     vlift_ = vlift iMonad_</span>
<span class=hs-linenum>715: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span>
<span class=hs-linenum>716: </span><span class='hs-comment'>-- ipartl (iMonadArray, iMonadPlus, iOrdered) p i (ys_l, zs_l, Suc xs_l) =</span>
<span class=hs-linenum>717: </span><span class='hs-comment'>--   vbind_</span>
<span class=hs-linenum>718: </span><span class='hs-comment'>--     (vread_ (vadd i (vadd ys_l zs_l)))</span>
<span class=hs-linenum>719: </span><span class='hs-comment'>--     ( \x -&gt;</span>
<span class=hs-linenum>720: </span><span class='hs-comment'>--         if vleq_ x p</span>
<span class=hs-linenum>721: </span><span class='hs-comment'>--           then</span>
<span class=hs-linenum>722: </span><span class='hs-comment'>--             vseq_</span>
<span class=hs-linenum>723: </span><span class='hs-comment'>--               (vswap_ (vadd i ys_l) (vadd i (vadd ys_l zs_l)))</span>
<span class=hs-linenum>724: </span><span class='hs-comment'>--               (ipartl_ p i (Suc ys_l, zs_l, xs_l))</span>
<span class=hs-linenum>725: </span><span class='hs-comment'>--           else ipartl_ p i (ys_l, Suc zs_l, xs_l)</span>
<span class=hs-linenum>726: </span><span class='hs-comment'>--     )</span>
<span class=hs-linenum>727: </span><span class='hs-comment'>--   where</span>
<span class=hs-linenum>728: </span><span class='hs-comment'>--     vbind_ = vbind iMonad_</span>
<span class=hs-linenum>729: </span><span class='hs-comment'>--     vread_ = vread iMonadArray</span>
<span class=hs-linenum>730: </span><span class='hs-comment'>--     vleq_ = vleq iOrdered</span>
<span class=hs-linenum>731: </span><span class='hs-comment'>--     vseq_ = vseq iMonad_</span>
<span class=hs-linenum>732: </span><span class='hs-comment'>--     vswap_ = vswap iMonadArray</span>
<span class=hs-linenum>733: </span><span class='hs-comment'>--     ipartl_ = ipartl (iMonadArray, iMonadPlus, iOrdered)</span>
<span class=hs-linenum>734: </span><span class='hs-comment'>--     iMonad_ = VMonadPlus.iMonad iMonadPlus</span></pre>
</body>
</html>